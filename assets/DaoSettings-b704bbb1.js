import{u as L,c as F,d as h,e as D,a as i,f as M,g as N,h as I,i as O,B as P,T as C,k as u,l,m as V,n as R,o as T,p as g,_ as E,q as c,t as y,v as m,w as Q,x as v,y as j,z as k,L as x,j as f,F as b,A as _}from"./index-00ad5add.js";function z(){const r=L(q),{daoAddress:n}=F(),t=h(n).data,e=D({initialValues:{ownerAddress:(t==null?void 0:t.daoRoles.owner)||"",proposalOwner:(t==null?void 0:t.daoRoles.proposalOwner)||""},validateOnChange:!1,validateOnBlur:!0,onSubmit:()=>{}});return i(M,{form:r,formik:e})}const q=({name:r,formik:n})=>{const{mutateAsync:t,isLoading:e}=N(),{mutateAsync:s,isLoading:o}=I(),a=n.values[r],d=n.initialValues[r],p=()=>{const S={newOwner:a,onError:B=>n.setFieldError(r,B)};if(r==="ownerAddress")return t(S);if(r==="proposalOwner")return s(S)},A=r==="ownerAddress"?e:o;return d===a?null:i(O,{children:i(P,{onClick:p,isLoading:A,children:i(C,{children:"Update"})})})},w=()=>{const{refetch:r,data:n}=R(),t=T();return async e=>{const s=n||(await r()).data;if((s==null?void 0:s.admin)!==t)throw new Error("You are not the registry admin");return e()}},U=()=>{const r=g(),n=w(),t=u();return l(async({daoIds:e,amount:s})=>n(async()=>{if(!E.isNumber(s))throw new Error("Forward Message Fee is required");if(s<0)throw new Error("Forward Message Fee must be at least 0");const a=await c.getClientV2();return c.setFwdMsgFee(t(),a,y,m.BASE.toString(),e.map(d=>d.toString()),s.toString())}),{onError:(e,s)=>{s.onError(e.message),r(e)},onSuccess:(e,s)=>{var o;return(o=s.onSuccess)==null?void 0:o.call(s)}})},G=()=>{const r=u(),n=g(),t=w();return l(async e=>t(async()=>{const o=r(),a=await c.getClientV2();return c.setNewDaoFwdMsgFee(o,a,y,m.BASE.toString(),e)}),{onError:e=>{n(e)},onSuccess:()=>{V("Forward Message Fee for new DAOs has been set successfully")}})},X=()=>{const r=u(),n=g(),t=w(),{refetch:e}=R();return l(async({newRegistryAdmin:s})=>t(async()=>{if(!s||!Q(s))throw new Error("Invalid register admin address");const a=await c.getClientV2();return c.setRegistryAdmin(r(),a,y,m.BASE.toString(),s)}),{onSuccess:(s,o)=>{e()},onError:(s,o)=>{o.onError(s.message),n(s)}})},Y=()=>{const r=u(),n=g(),t=w();return l(async({value:e})=>t(async()=>{if(!E.isNumber(e)||e<0)throw new Error("Fee must be zero or positive");const o=await c.getClientV2();return c.setDeployAndInitDaoFee(r(),o,y,m.BASE.toString(),e.toString())}),{onSuccess:()=>{V("Create DAO Fee has been set successfully")},onError:(e,s)=>{s.onError(e.message),n(e)}})},$=()=>{const r=u(),n=T(),t=g(),e=w();return l(async s=>e(async()=>{if(!Object.keys(c.ReleaseMode).includes(s.toString()))throw new Error("Invalid release mode");const a=await c.getClientV2(),d=r();return c.newRegistry(d,a,s,m.BASE.toString(),n)}),{onError:s=>t(s)})},H={useSetDaoFwdMsgFee:U,useSetFwdFeeForNewDaos:G,useSetRegistryAdmin:X,useSetCreateDaoFee:Y,useCreateNewRegistry:$},J=()=>({title:"Dao Admin Settings",inputs:[{name:"fwdMsgFee",label:"Forward Message Fee",type:"number",EndAdornment:W}]});function K(){const r=J(),{daoAddress:n}=F(),{data:t}=v(n),e=D({enableReinitialize:!0,initialValues:{fwdMsgFee:Number(t==null?void 0:t.fwdMsgFee)},validateOnChange:!1,validateOnBlur:!0,onSubmit:()=>{}});return i(M,{form:r,formik:e})}const W=({name:r,formik:n})=>{const{daoAddress:t}=F(),e=n.values[r],s=n.initialValues[r],o=h(t).data,{mutate:a,isLoading:d}=H.useSetDaoFwdMsgFee(),{refetch:p}=v(o==null?void 0:o.daoAddress),A=()=>{if(r==="fwdMsgFee")return a({daoIds:[o.daoId],amount:e,onError:S=>n.setFieldError(r,S),onSuccess:p})};return!E.isNumber(e)||s===e?null:i(O,{children:i(P,{onClick:A,isLoading:d,children:i(C,{children:"Update"})})})};function ee(){const r=j(),{daoAddress:n}=F(),{isLoading:t,data:e}=h(n),{isOwner:s,isProposalPublisher:o}=k(e==null?void 0:e.daoRoles),a=s||o;return i(x,{title:r.settings,isLoading:t,children:f(b,{children:[i(K,{}),a&&f(b,{children:[i(z,{}),i(_,{})]})]})})}export{ee as DaoSettings,ee as default};
